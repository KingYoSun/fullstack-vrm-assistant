# 2025-11-28 進捗レポート

## 概要
- Phase 4: 最低限の運用性を完了（構造化ログ、ready/health、フォールバック）。
- Phase 0/1/2 を完了し、音声 WebSocket パイプラインと RAG バックエンドの骨格を整備。
- Phase 3: Frontend MVP を完了（WebSocket コンソール + VRM 表示/リップシンク + チャットログ UI）。

## 成果
- Backend: request ID ミドルウェアを追加し、JSON 構造化ログに request_id/session_id/turn_id/latency を埋め込むように変更。STT/LLM/TTS の主要レイテンシを WS/SSE の両パスで計測してログ/イベントに出力。
- WebSocket: LLM/TTS 失敗時にテンプレ応答を返しつつ TTS ストリームを継続するフォールバックを追加し、`error`/`ready` で request_id をクライアントへ通知。
- Ops: `/ready` を追加し、DB 接続可否と RAG インデックス読み込み状態を返すヘルスチェックを実装（/health は構成サマリを返却）。
- Frontend: react-three-fiber + three-vrm で VRM 表示と RMS ベースの mouth open メーターを実装し、VRM URL 切替に対応。
- WebSocket クライアント UI を刷新し、partial/final transcript と LLM 応答を shadcn 風カードで表示、レイテンシ/TTS 受信量を合わせて確認できるようにした（`pnpm build` でビルド確認）。
- FastAPI バックエンドの骨格と DI/health を追加し、providers.yaml を読み込む ProviderRegistry を実装。
- SSE ストリーミングの `POST /api/v1/text-chat` を実装（RAG 検索 + LLM 逐次出力 + PostgreSQL 会話ログ保存）。
- LangChain+FAISS ingest CLI（`python -m app.cli.ingest --source docs --index /data/faiss/index.bin`）を追加し、/data ボリュームにインデックスを永続化。
- docker-compose.dev に PostgreSQL サービスと /data マウントを追加し、`.env`/`.env.default` に DB 環境変数を定義。
- `docker-compose.dev.yml` を追加し、backend/frontend を bind mount で立ち上げる dev プロファイルと echo ベースのモックプロバイダを用意。
- `.env` / `.env.default` を作成し、ポートやプロバイダエンドポイントを一元管理（`.env` は gitignore 済み）。
- `Makefile` に dev 起動/停止/ログ確認コマンド (`make dev`/`make dev-all`/`make dev-down`/`make dev-logs`/`make dev-ps`) を追加。
- `docs/03_implementation/mvp_plan.md` の Phase 0 を完了として更新し、実装ガイド summary に利用方法を追記。

## 課題
- LLM/STT/TTS 実プロバイダ接続と音声品質/レイテンシ検証は未着手（現状モック前提）。
- RAG インデックスは未生成（ingest コマンドによる docs 取り込みが必要）。`/ready` が degraded になるため対応が必要。
- VRM のデフォルトは外部 URL 参照のため、オフライン配布やライセンス確認の検討が必要。

## 次のアクション
- 実プロバイダ（LLM/STT/TTS）での接続検証と音声入出力レイテンシ計測、チャットログ UI での観測。
- RAG ingest ジョブの実行と回答精度確認。
- VRM アセットのローカル配置案や軽量モデル検討（低帯域・モバイル考慮）。
