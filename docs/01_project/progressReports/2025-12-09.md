# 2025年12月09日 進捗レポート
> SnapMoGen 関連の記述はライセンス上の理由で archive 済み（`docs/04_archive/motion_snapmogen_plan.md`）。以降は Motion Diffusion Model への置換を進行中。

## 概要
- フロントエンドの状態管理を Zustand 5 に移行し、App.tsx からロジックを分離して可読性を大幅に向上させた。
- WebSocket 制御、マイク録音、診断リクエスト、キャラクター/システムプロンプト CRUD をストアのアクションに集約し、各コンポーネントはストア参照で配線を簡素化。
- 依存追加と lint 確認まで完了し、動作確認済み。
- モーション生成マイクロサービスのスタブと backend/frontend の初期統合を実施し、compose/.env に Motion 設定を追加（当時の内容は archive を参照）。

## 成果
- `frontend/src/store/appStore.ts`: 接続/録音/音声再生/診断/ペルソナ CRUD/ドロワー開閉などを網羅するグローバルストアを新設。デフォルト URL 正規化やログ、VRM オブジェクト URL の開放も統一。
- `frontend/src/components/*`: ControlDock, RemotePanel, StreamPanel, 各 Drawer がストアを直接参照する形に更新し、props 配線を大幅削減。
- `frontend/src/App.tsx`: VRM ファイル入力と viewport 判定の副作用のみを保持し、描画とライフサイクルに専念する薄いエントリに整理。
- `frontend/package.json`, `frontend/pnpm-lock.yaml`: `zustand@5.0.9` を追加。
- `motion_service/*`, `docker/motion-mdm/Dockerfile`, `docker-compose.yml`: モーション生成ラッパの FastAPI スタブと GPU コンテナを追加し、/data/animations へ VRM キー列 JSON を保存する初期実装を用意。
- `backend/app/*`: MotionProviderConfig/Client、`/api/v1/motion/generate`、Diagnostics `/diagnostics/motion`、WS `assistant_motion` を追加し、`/data` を StaticFiles で配信。
- `frontend/src/components/drawers/DiagnosticsDrawer.tsx`: Motion 診断カードを追加し、WS `assistant_motion` を受信表示できるように拡張。
- テスト: `pnpm lint`（frontend）を実行し通過。

## 課題
- UI から発火するストアアクションが増えたため、将来的に自動テスト（RTL/Vitest）で主要フローをカバーしたい。
- Motion Diffusion Model (MDM) 本体の推論呼び出しと VRM 再生ロジック（three-vrm 連携、motion_prompt 抽出/同期）が未実装。

## 次のアクション
- MDM 推論コードと VRM 再生/同期処理を実装し、生成結果を front で実再生できるようにする。
- Vitest などでストアの主要アクション（接続、録音開始/停止、診断 API 呼び出し、キャラクター CRUD）の単体テスト/モック検証を追加する。
- 実機での操作確認を継続し、ストア更新に伴うパフォーマンス影響がないか（特にモバイル）を観察する。
