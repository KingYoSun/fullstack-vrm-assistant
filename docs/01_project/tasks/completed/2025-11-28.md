# 2025年11月28日

- Phase 0: インフラ雛形整備を完了。
  - `docker-compose.dev.yml` を追加し、backend/frontend の dev プロファイルとモックプロバイダを構成。
- `.env` / `.env.default` を作成してポート・エンドポイント設定を集約（`.env` は gitignore 済み）。
  - `Makefile` で dev 起動/停止/ログ確認のラッパーを用意。
  - `docs/03_implementation/mvp_plan.md` の Phase 0 を完了状態に更新。
- Phase 1: Backend スケルトン + Text Chat を完了。
  - FastAPI バックエンドの骨格（設定/DI/health）を追加し、providers.yaml から LLM/RAG/Embedding をロードする ProviderRegistry を構築。
  - SSE ストリーミング対応の `POST /api/v1/text-chat` を実装し、RAG 検索と会話ログ保存（PostgreSQL dev サービス追加）を組み込み。
  - LangChain+FAISS ingest CLI `python -m app.cli.ingest --source docs --index /data/faiss/index.bin` を用意し、RAG インデックスを `/data` ボリュームに保存できるようにした。
- Phase 2: WebSocket 音声 I/O 設計を完了。
  - `docs/03_implementation/mvp_plan.md` の Phase 2 チェックリストを完了とし、WS エンドポイント/キュー/タイムアウト要件を反映。
  - `docs/03_implementation/phase2_websocket.md` にメッセージ種別、フロー、backpressure/再接続方針、依存ライブラリ候補を追記して仕様を確定。
- Phase 2: WebSocket バックエンド実装を着手。
  - `/ws/session/{id}` のセッション処理を拡張し、音声チャンクのキュー制御、サイレント自動フラッシュ、partial/final transcript、LLM/TTS ストリーム（`tts_start`/`tts_end`、`avatar_event`）を送出するパイプラインを実装。
  - ProviderRegistry に STT/TTS クライアントを追加し、HTTP ベースの STT/TTS 呼び出しとフォールバックのサイレントチャンクを用意。
  - `python3 -m compileall app` でシンタックス確認済み。
- Phase 2: WebSocket バックエンドを Phase3 開始準備まで拡張。
  - Opus→PCM 変換（ffmpeg）と `webrtcvad` による無音検出で turn 自動確定、バックログ超過時のドロップ通知を追加。
  - STT クライアントに WS/HTTP 両対応とタイムアウトを追加し、TTS/LLM でレイテンシ計測メタデータ (`latency_ms`) を送出。`avatar_event` は RMS ベースに変更。
  - 依存に `webrtcvad` / `websockets` を追加。
- Phase 2: Docker/dev 環境に ffmpeg と新依存を取り込み、Phase 3 着手準備完了。
  - `docker-compose.dev.yml` の backend サービスで ffmpeg を apt インストールする手順を追加し、音声デコード前提を満たした。
  - `docs/03_implementation/summary.md` に Backend 依存（ffmpeg/webrtcvad/websockets）メモを追記。
- Phase 3: Frontend スキャフォールド開始。
  - `frontend/` を Vite+React+TypeScript (pnpm) で初期化し、`pnpm install`/`pnpm dev` が動く状態にした。
  - `src/App.tsx` に `/ws/session/{id}` 用の接続コンソール（partial/final/llm/tts/log表示、control ping/flush/resume 送信）を実装し、ビルド確認済み（`pnpm build`）。
- Phase 3: 音声 I/O コンソールを強化し、Phase 3 着手準備を完了。
  - マイク取得→MediaRecorder(Opus) 100ms チャンク送信、受信 TTS チャンクのバッファリングと再生（Audio/Opus）を追加。`avatar_event`/レイテンシ表示とログ出力を拡充。
  - WebSocket バックエンドのデコードを自動判別（WebM/OGG/Opus/raw）→PCM にし、フロント送信（WebM Opus）と接続しやすくした。
- Phase 3: Frontend MVP を完了。
  - react-three-fiber + three-vrm で VRM 表示を追加し、TTS オーディオ RMS と `avatar_event` を併用した mouth open メーターで簡易リップシンクを実現（VRM URL の切り替えも可能）。
  - STT/LLM テキストを shadcn 風カードで整理したチャットログを実装し、partial transcript・レイテンシ・TTS 受信バイトをまとめて確認できる UI に刷新。
  - `three` / `@react-three/fiber` / `@react-three/drei` / `@pixiv/three-vrm` を依存追加し、型補助の d.ts を用意した上で `pnpm build` にてビルド確認。
- Phase 4: 最低限の運用性を完了。
  - JSON 構造化ログと request ID ミドルウェアを追加し、WS/SSE 双方で STT/LLM/TTS のレイテンシをイベントとログに記録。
  - `/ready` エンドポイントを実装し、DB 接続可否と RAG インデックス読み込み状態を返却（/health はアプリ/プロバイダサマリ）。
  - WebSocket パイプラインで LLM/TTS 失敗時のテンプレ応答フォールバックと `error` メッセージへの request_id 付与を行い、監視しやすくした。
